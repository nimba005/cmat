<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üåç CMAT Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>

  <!-- NAVIGATION BAR -->
  <nav class="navbar">
    <div class="nav-left">
      <h2>
        <img src="{{ url_for('static', filename='images/gv_zambia.png') }}" 
            alt="National Assembly Logo" 
            class="logo">
        NATIONAL ASSEMBLY OF ZAMBIA
      </h2>
    </div>
    <div class="nav-right">
      <a href="/" class="nav-link">Home</a>
      <a href="/about" class="nav-link">About</a>
      {% if session.get("user") %}
        <a href="/calendar" class="nav-link">Calendar</a>
        <a href="/upload" class="nav-link">Upload Doc</a>
        <a href="/survey" class="nav-link">Survey</a>
        <a href="/logout" class="nav-link">Logout</a>
      {% else %}
        <a href="/login" class="nav-link">Login</a>
      {% endif %}
    </div>
  </nav>

  <!-- PAGE CONTENT -->
  <div class="page-container">

    <!-- FLASH MESSAGES -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flash-messages">
          {% for category, message in messages %}
            <div class="flash {{ category }}">{{ message }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    {% if page == "home" %}
      <div class="top-header">
        <h2>üåç Welcome to CMAT Dashboard</h2>
        <p>AI-enabled tool for tracking Zambia‚Äôs climate finance and policies.</p>
      </div>
      <div class="section">
        <h3>üìå Overview</h3>
        <p>
          The Climate Monitoring & Accountability Tool (CMAT) strengthens parliamentary oversight by 
          tracking climate budgets, programmes, and indicators. Navigate through the menu above to 
          explore more.
        </p>
      </div>

      <!-- UPDATED: About section with clickable PDF cards -->
      <div class="section">
        <h2>üì∞ About the Tool</h2>
        <p>Learn more about the Monitoring and Accountability tool</p>

        <div class="docs-grid">
          <a href="{{ url_for('download_file', filename='climate_insights.pdf') }}" target="_blank" class="doc-card">
            <div class="icon">üåç</div>
            <h3>Climate Insights</h3>
            <p>Latest news, analysis, and developments on climate action and sustainability efforts.</p>
          </a>

          <a href="{{ url_for('download_file', filename='resources.pdf') }}" target="_blank" class="doc-card">
            <div class="icon">üìö</div>
            <h3>Explore Resources</h3>
            <p>Access a repository of climate-related documents for easy reference and exploration.</p>
          </a>

          <a href="{{ url_for('download_file', filename='gis_projects.pdf') }}" target="_blank" class="doc-card">
            <div class="icon">üó∫Ô∏è</div>
            <h3>GIS Projects</h3>
            <p>Verify on-the-ground climate projects with our GIS tool for accurate tracking.</p>
          </a>
        </div>
      </div>

      <!-- üåç CLIMATE CONTENT SLIDESHOW -->
      <div class="section">
        <h2>üåç Content on Climate Change</h2>
        <p>Explore highlights on climate action, policies, and key events</p>

        <div class="carousel-container">
          <button class="carousel-btn prev" onclick="scrollCarousel(-1)">‚¨ÖÔ∏è</button>
          <div class="carousel" id="climate-carousel">
      
            <a href="{{ url_for('download_file', filename='cop28.pdf') }}" target="_blank" class="carousel-card">
              <img src="{{ url_for('static', filename='images/COP-28.png') }}" alt="COP-28">
              <h3>COP-28</h3>
              <p>Highlights from COP-28 showcasing international commitments.</p>
            </a>

            <a href="{{ url_for('download_file', filename='climate_finance.pdf') }}" target="_blank" class="carousel-card">
              <img src="{{ url_for('static', filename='images/image.png') }}" alt="Climate Finance">
              <h3>Climate Finance</h3>
              <p>Insights on financing climate projects and mobilizing resources.</p>
            </a>

            <a href="{{ url_for('download_file', filename='impact.pdf') }}" target="_blank" class="carousel-card">
              <img src="{{ url_for('static', filename='images/impact.png') }}" alt="Climate Impact">
              <h3>Climate Change Impact</h3>
              <p>Examining the effects of climate change on communities.</p>
            </a>

            <a href="{{ url_for('download_file', filename='cop29.pdf') }}" target="_blank" class="carousel-card">
              <img src="{{ url_for('static', filename='images/cop29.jpg') }}" alt="COP-29">
              <h3>COP-29</h3>
              <p>Looking ahead to COP-29 and key negotiations.</p>
            </a>

            <a href="{{ url_for('download_file', filename='policy.pdf') }}" target="_blank" class="carousel-card">
              <img src="{{ url_for('static', filename='images/policy.jpg') }}" alt="Policy">
              <h3>Climate Change Policy</h3>
              <p>Understanding Zambia‚Äôs and global climate policies.</p>
            </a>

            <a href="{{ url_for('download_file', filename='agnes.pdf') }}" target="_blank" class="carousel-card">
              <img src="{{ url_for('static', filename='images/AGNES.png') }}" alt="AGNES">
              <h3>Learn about AGNES</h3>
              <p>Discover the role of AGNES in climate negotiations.</p>
            </a>

          </div>
          <button class="carousel-btn next" onclick="scrollCarousel(1)">‚û°Ô∏è</button>
        </div>
      </div>

      <script>
        const carousel = document.getElementById("climate-carousel");
        const scrollAmount = 320; // card width + gap

        // Clone all cards and append to the carousel (for seamless loop)
        const cards = Array.from(carousel.children);
        cards.forEach(card => {
          const clone = card.cloneNode(true);
          carousel.appendChild(clone);
        });

        function scrollCarousel(direction = 1) {
          carousel.scrollBy({ left: direction * scrollAmount, behavior: "smooth" });

          // If we've scrolled past half the content (original set), reset back
          if (carousel.scrollLeft >= carousel.scrollWidth / 2) {
          carousel.scrollTo({ left: 0, behavior: "auto" });
          }
        }

        // Auto-scroll every 3s (you can change speed)
        setInterval(scrollCarousel, 3000);
      </script>





      <!-- NEW: News & Articles Section -->
      <div class="section">
        <h2>üì∞ News & Articles</h2>
        <p>Always up to date with our latest News and Articles</p>

        <div class="news-grid">

          <div class="news-card">
            <img src="{{ url_for('static', filename='images/blog1.jpg') }}" alt="Blog Image">
            <h3>Report of the Committee on Agriculture</h3>
            <small>Posted by parliamentary ‚Ä¢ September 2025</small>
            <p>Examining the effects of climate change on agriculture, lands and natural resources in Zambia.</p>
            <a href="{{ url_for('download_file', filename='Report of the Committee on Agriculture, Lands and Natural Resources on Carbon Markets and Trading in Zambia.pdf') }}" target="_blank">Read More</a>
          </div>

          <div class="news-card">
            <img src="{{ url_for('static', filename='images/blog2.jpg') }}" alt="Blog Image">
            <h3>This is the latest News Content</h3>
            <small>Posted by Admin ‚Ä¢ March 2024</small>
            <p>Lorem ipsum dolor sit amet, consectetur de adipisicing elit, sed do eiusmod tempore incididunt ut labore et dolore magna.</p>
            <a href="{{ url_for('download_file', filename='news2.pdf') }}" target="_blank">Read More</a>
          </div>

          <div class="news-card">
            <img src="{{ url_for('static', filename='images/blog3.jpg') }}" alt="Blog Image">
            <h3>This is the latest News Content</h3>
            <small>Posted by Admin ‚Ä¢ March 2024</small>
            <p>Lorem ipsum dolor sit amet, consectetur de adipisicing elit, sed do eiusmod tempore incididunt ut labore et dolore magna.</p>
            <a href="{{ url_for('download_file', filename='news3.pdf') }}" target="_blank">Read More</a>
          </div>

        </div>
      </div>

      <!-- üìä FINANCIAL DOCUMENTS SECTION -->
      <div class="section">
        <h2>üìä Financial Reports by Year</h2>
        <p>Browse annual financial documents and reports</p>

        <div class="carousel-container">
          <button class="carousel-btn prev" onclick="scrollFinancial(-1)">‚¨ÖÔ∏è</button>
          <div class="carousel" id="financial-carousel">

            <!-- Example yearly docs -->
            <a href="{{ url_for('download_file', filename='2016Budget.pdf') }}" target="_blank" class="carousel-card">
              <img src="{{ url_for('static', filename='images/finance2016.jpg') }}" alt="Financial 2016">
              <h3>Financial Report 2016</h3>
              <p>Annual budget & expenditure summary</p>
            </a>

            <a href="{{ url_for('download_file', filename='Yellow Book 2017.pdf') }}" target="_blank" class="carousel-card">
              <img src="{{ url_for('static', filename='images/finance2017.jpg') }}" alt="Financial 2017">
              <h3>Financial Report 2017</h3>
              <p>Annual budget & expenditure summary</p>
            </a>

            <a href="{{ url_for('download_file', filename='2021 Yellow Book.pdf') }}" target="_blank" class="carousel-card">
              <img src="{{ url_for('static', filename='images/finance2021.jpg') }}" alt="Financial 2021">
              <h3>Financial Report 2021</h3>
              <p>Annual budget & expenditure summary</p>
            </a>

            <a href="{{ url_for('download_file', filename='2022 YELLOW BOOK.pdf') }}" target="_blank" class="carousel-card">
              <img src="{{ url_for('static', filename='images/finance2022.jpg') }}" alt="Financial 2022">
              <h3>Financial Report 2022</h3>
              <p>Climate finance allocations and spending</p>
            </a>

            <a href="{{ url_for('download_file', filename='07 Main Report Budget 2023.pdf') }}" target="_blank" class="carousel-card">
              <img src="{{ url_for('static', filename='images/finance2023.jpg') }}" alt="Financial 2023">
              <h3>Financial Report 2023</h3>
              <p>Parliamentary oversight and analysis</p>
            </a>

            <a href="{{ url_for('download_file', filename='2024_20National_20Budget_20OBB.pdf') }}" target="_blank" class="carousel-card">
              <img src="{{ url_for('static', filename='images/finance2024.jpg') }}" alt="Financial 2024">
              <h3>Financial Report 2024</h3>
              <p>Detailed expenditure and projections</p>
            </a>

            <a href="{{ url_for('download_file', filename='2025_20APPROVED_20BUDGET.pdf') }}" target="_blank" class="carousel-card">
              <img src="{{ url_for('static', filename='images/finance2025.jpg') }}" alt="Financial 2025">
              <h3>Financial Report 2025</h3>
              <p>Detailed expenditure and projections</p>
            </a>

          </div>
          <button class="carousel-btn next" onclick="scrollFinancial(1)">‚û°Ô∏è</button>
        </div>
      </div>

      <script>
        const financialCarousel = document.getElementById("financial-carousel");
        const financialScroll = 320; // card width + gap

        // Clone for seamless loop
        const financialCards = Array.from(financialCarousel.children);
        financialCards.forEach(card => {
          const clone = card.cloneNode(true);
          financialCarousel.appendChild(clone);
        });

        function scrollFinancial(direction = 1) {
          financialCarousel.scrollBy({ left: direction * financialScroll, behavior: "smooth" });

          // Reset loop
          if (financialCarousel.scrollLeft >= financialCarousel.scrollWidth / 2) {
            financialCarousel.scrollTo({ left: 0, behavior: "auto" });
          }
        }

        // Auto-scroll every 4s
        setInterval(scrollFinancial, 4000);
      </script>



    {% elif page == "about" %}
      <div class="section">
        <h2>‚ÑπÔ∏è About CMAT</h2>
        <p>
          The <strong>Climate Monitoring & Accountability Tool (CMAT)</strong> is an AI-enabled 
          platform developed by the <strong>National Assembly of Zambia (NAZ)</strong> in 
          collaboration with <strong>AGNES</strong>.
        </p>

        <h3>üìú Background & Context</h3>
        <ul>
          <li>Developed in line with <strong>NAZ Standing Orders (2024)</strong> and the <strong>National Planning and Budgeting Act No. 1 of 2020</strong>.</li>
          <li>Focuses on oversight of the <strong>Ministry of Green Economy and Environment</strong>.</li>
          <li>Supports alignment with international commitments (Paris Agreement, NDCs).</li>
        </ul>

        <h3>üéØ Objectives</h3>
        <ol>
          <li>Track climate-related laws, budgets, and strategies.</li>
          <li>Strengthen transparency in climate finance.</li>
          <li>Promote accountability in project implementation.</li>
          <li>Enhance public engagement and awareness.</li>
        </ol>
      </div>

      <div class="section">
        <h3>üìä Indicators for CMAT</h3>
        <p>Indicators are grouped under the following categories:</p>

        <details>
          <summary>üìå Legislative</summary>
          <ul>
            <li>Number of Climate-Related Laws Enacted</li>
            <li>Quality of Climate Legislation</li>
            <li>Timeliness of Law Implementation</li>
          </ul>
        </details>

        <details>
          <summary>üìå Financial</summary>
          <ul>
            <li>Total Public Investment in Climate Initiatives</li>
            <li>Budget % Allocated to Climate Adaptation</li>
            <li>Private Sector Investment Mobilized</li>
          </ul>
        </details>
      </div>

      <div class="section">
        <h3>üìÇ Reports & Resources</h3>
        <ul>
          <li>üìò National Climate Indicators Report (2025) <em>(Coming Soon)</em></li>
          <li>üìó Annual Budget Oversight Report <em>(Draft in progress)</em></li>
          <li>üìÑ Public Awareness Briefs (2025)</li>
        </ul>
      </div>

      <!-- SLIDESHOW DYNAMIC -->
      <div class="section">
        <h3>üè∑ Featured National Climate Projects</h3>
        <div id="slideshow">
          {% for project in projects %}
            <div class="slide {% if loop.first %}active{% endif %}">
              <img src="{{ url_for('static', filename=project.img) }}" alt="{{ project.title }}">
              <h4>{{ project.title }}</h4>
              <p>{{ project.desc }}</p>
            </div>
          {% endfor %}
        </div>
        <div class="slideshow-controls">
          <button onclick="prevSlide()">‚¨ÖÔ∏è Prev</button>
          <button onclick="nextSlide()">Next ‚û°Ô∏è</button>
        </div>
      </div>

      <script>
        let slides = document.querySelectorAll("#slideshow .slide");
        let current = 0;

        function showSlide(index) {
          slides.forEach((s, i) => s.classList.toggle("active", i === index));
        }

        function nextSlide() {
          current = (current + 1) % slides.length;
          showSlide(current);
        }

        function prevSlide() {
          current = (current - 1 + slides.length) % slides.length;
          showSlide(current);
        }

        setInterval(nextSlide, 5000);
      </script>

    {% elif page == "calendar" %}
      <div class="section">
        <h2>üìÖ Zambia‚Äôs Legislative Calendar</h2>
        <p>Stay updated with Zambia‚Äôs official legislative calendar and track important events.</p>
        <div id="calendar"></div>
      </div>

      <!-- FullCalendar.js Integration -->
      <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css" rel="stylesheet">
      <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>

      <script>
        document.addEventListener("DOMContentLoaded", function () {
          const calendarEl = document.getElementById("calendar");

          const calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: "dayGridMonth",
            events: "/api/events", // üîó Load events from Flask API
            selectable: true,

            // Add new events
            select: function(info) {
              const title = prompt("Enter Event Title:");
              if (title) {
                fetch("/api/events", {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify({
                    title: title,
                    start: info.startStr,
                    end: info.endStr
                  })
                })
                .then(res => res.json())
                .then(() => calendar.refetchEvents());
              }
            },
            // Delete existing events
            eventClick: function(info) {
              if (confirm(`Delete event: "${info.event.title}"?`)) {
                fetch(`/api/events/${info.event.id}`, { method: "DELETE" })
                  .then(res => res.json())
                  .then(() => calendar.refetchEvents());
              }
            }
          });

          calendar.render();
        });
      </script>


    {% elif page == "upload" %}
      <div class="section">
        <h2>üìë Upload Document</h2>
        <p>Upload a budget or climate policy PDF. The AI will extract and analyze key allocations.</p>
        <form id="uploadForm" enctype="multipart/form-data">
          <input type="file" name="pdf" accept="application/pdf" required>
          <button type="submit">Upload & Analyze</button>
        </form>
      </div>

      <div class="section">
        <h3>Extracted Budget Info</h3>
        <pre id="budgetInfo"></pre>
      </div>

      <div class="section">
        <h3>Agriculture Budget Chart</h3>
        <div id="agriChart"></div>
      </div>

      <div class="section">
        <h3>Climate Programmes</h3>
        <div id="climateChart"></div>
      </div>

      <script>
        document.getElementById("uploadForm").addEventListener("submit", async (e) => {
          e.preventDefault();
          const formData = new FormData(e.target);

          const res = await fetch("/upload", { method: "POST", body: formData });
          const data = await res.json();

          document.getElementById("budgetInfo").innerText = JSON.stringify(data.budget_info, null, 2);

          if (data.agriculture) {
            const x = data.agriculture.map(d => d.Programme);
            const y = data.agriculture.map(d => d["2024"]);
            Plotly.newPlot("agriChart", [{
              x, y, type: "bar", text: y, textposition: "outside"
            }], { title: "Agriculture Budget 2024" });
          }

          if (data.climate_programmes) {
            const x = data.climate_programmes.map(d => d.Programme);
            const y = data.climate_programmes.map(d => d["2024"]);
            Plotly.newPlot("climateChart", [{
              x, y, type: "bar", text: y, textposition: "outside"
            }], { title: "Climate Programmes 2024" });
          }
        });
      </script>

    {% elif page == "survey" %}
      <div class="section">
        <h2>üìù CMAT Survey</h2>
        <p>Manually enter or review extracted indicator values here. (Form integration coming soon)</p>
      </div>

    {% elif page == "login" %}
      <div class="section">
        <h2>üîê Login</h2>
        <form method="POST" action="/login">
          <input type="text" name="username" placeholder="Username" required>
          <input type="password" name="password" placeholder="Password" required>
          <button type="submit">Login</button>
        </form>
        <p>Don‚Äôt have an account? <a href="/signup">Sign up</a></p>
      </div>

    {% elif page == "signup" %}
      <div class="section">
        <h2>üìù Signup</h2>
        <form method="POST" action="/signup">
          <input type="text" name="username" placeholder="Username" required>
          <input type="password" name="password" placeholder="Password" required>
          <button type="submit">Signup</button>
        </form>
        <p>Already have an account? <a href="/login">Login</a></p>
      </div>
    {% endif %}

  </div>

  <!-- FOOTER -->
  <div class="footer">
    <p>¬© 2025 CMAT | Built for Climate Finance Oversight</p>
    <p><a href="mailto:zambiaparliament.com">Contact Support</a></p>
  </div>

</body>
</html>
